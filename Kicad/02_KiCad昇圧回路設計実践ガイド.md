# KiCad 昇圧回路設計実践ガイド

このガイドでは、KiCadを使った実際の回路設計の流れを、昇圧回路（Boost Converter）を例に解説します。

## 目次

1. [プロジェクトの作成](#1-プロジェクトの作成)
2. [ライブラリの設定](#2-ライブラリの設定)
3. [回路図の作成](#3-回路図の作成)
4. [部品の配置](#4-部品の配置)
5. [配線](#5-配線)
6. [部品値の設定](#6-部品値の設定)
7. [フットプリントの割り当て](#7-フットプリントの割り当て)
8. [PCBレイアウト](#8-pcbレイアウト)
9. [配線（ルーティング）](#9-配線ルーティング)
10. [グラウンドプレーンの作成](#10-グラウンドプレーンの作成)
11. [デザインルールチェック](#11-デザインルールチェック)

---

## 1. プロジェクトの作成

### KiCadの起動

KiCadを起動すると、プロジェクトマネージャが表示されます。

![KiCadスタート画面](02_figure/01_kicad_start_screen.png)

### 新規プロジェクトの作成

1. **ファイル (F)** → **新規プロジェクト** を選択
2. プロジェクト名を入力（例: `karihai_boost`）
3. 保存場所を選択

プロジェクトが作成されると、以下のファイルが生成されます:

![プロジェクトファイル一覧](02_figure/02_project_files_list.png)

- `.kicad_pro` - プロジェクトファイル
- `.kicad_sch` - 回路図ファイル
- `.kicad_pcb` - PCBファイル

---

## 2. ライブラリの設定

### シンボルライブラリの設定

初回起動時には、グローバルシンボルライブラリテーブルの設定が必要です。

![グローバルシンボルライブラリ設定](02_figure/03_global_symbol_library_table_dialog.png)

**推奨設定**: 既定のグローバルシンボルライブラリテーブルをコピー（推奨）

### フットプリントライブラリの設定

同様に、フットプリントライブラリの設定も行います。

![グローバルフットプリントライブラリ設定](02_figure/05_global_footprint_library_table_dialog.png)

**推奨設定**: 既定のグローバルフットプリントライブラリテーブルをコピー（推奨）

---

## 3. 回路図の作成

### 回路図エディタを開く

プロジェクトマネージャから**回路図エディタ**アイコンをクリックします。

![空の回路図エディタ](02_figure/04_schematic_editor_blank.png)

空白の回路図シートが表示されます。

---

## 4. 部品の配置

### 部品配置の基本操作

部品を配置するには、**A**キーを押すか、右側のツールバーから部品追加アイコンをクリックします。

### 今回使用する部品リスト

昇圧回路に必要な部品:
- **NMOS**: NチャンネルMOSFET（スイッチング素子）
- **L**: インダクタ（エネルギー蓄積）
- **D**: ダイオード（整流）
- **C**: コンデンサ（平滑）
- **R**: 抵抗（ゲート/負荷）
- **Screw_Terminal**: スクリュー端子（入出力端子）
- **GND**: グラウンド記号

### MOSFETの配置

1. **A**キーを押してシンボル選択ダイアログを開く
2. フィルターに `nmos` と入力

![NMOSシンボル選択](02_figure/07_symbol_chooser_nmos.png)

3. **NMOS** を選択して配置

### インダクタの配置

1. **A**キーを押す
2. フィルターに `l` と入力

![インダクタシンボル選択](02_figure/08_symbol_chooser_inductor.png)

3. **L** (Inductor) を選択して配置

### 抵抗の配置

1. **A**キーを押す
2. フィルターに `r` と入力

![抵抗シンボル選択](02_figure/09_symbol_chooser_resistor.png)

3. **R** (Resistor) を選択して配置

### コンデンサの配置

1. **A**キーを押す
2. フィルターに `c` と入力

![コンデンサシンボル選択](02_figure/10_symbol_chooser_capacitor.png)

3. **C** (Unpolarized capacitor) を選択して配置

### ダイオードの配置

1. **A**キーを押す
2. フィルターに `d` と入力

![ダイオードシンボル選択](02_figure/11_symbol_chooser_diode.png)

3. **D** (Diode) を選択して配置

### スクリュー端子の配置

1. **A**キーを押す
2. フィルターに `screw_terminal` と入力

![スクリュー端子シンボル選択](02_figure/12_symbol_chooser_screw_terminal.png)

3. **Screw_Terminal_01x02** を選択して配置（入出力用に複数配置）

### GNDの配置

1. **A**キーを押す
2. フィルターに `gnd` と入力

![GNDシンボル選択](02_figure/14_symbol_chooser_gnd.png)

3. **GND** (Power ground) を選択して配置

### 全部品配置後の状態

![部品配置完了](02_figure/13_schematic_with_components.png)

---

## 5. 配線

### 配線の基本操作

- **W**キーを押すと配線モードになります
- 部品のピンをクリックして、接続先のピンまでドラッグします
- **ESC**キーで配線モードを終了します

### 昇圧回路の配線

昇圧回路の基本構成:
1. 入力端子 → インダクタ → MOSFETのドレイン/ダイオードのアノード
2. MOSFETのソース → GND
3. ダイオードのカソード → 出力コンデンサ → 出力端子
4. ゲート抵抗 → MOSFETのゲート

![配線完了](02_figure/15_schematic_wired.png)

**配線のポイント**:
- インダクタとMOSFET/ダイオードの接続点が重要
- GNDはすべてのGND記号で共通接続される
- ネット名（配線名）は自動的に割り当てられる

---

## 6. 部品値の設定

### シンボルプロパティの編集

部品をダブルクリックするか、**E**キーを押すとプロパティダイアログが開きます。

### インダクタの値設定

![インダクタプロパティ](02_figure/16_symbol_properties_inductor.png)

- **リファレンス**: L1
- **値**: 470µH（または使用する値）
- **フットプリント**: 後で設定

### ダイオードの値設定

![ダイオードプロパティ](02_figure/19_symbol_properties_diode.png)

- **リファレンス**: D1
- **値**: D（または型番: MA10EB045など）

### コンデンサの値設定

![コンデンサプロパティ](02_figure/20_symbol_properties_capacitor.png)

- **リファレンス**: C1
- **値**: 1000µF

### 抵抗の値設定

![抵抗プロパティ](02_figure/22_symbol_properties_resistor.png)

- **リファレンス**: R1, R2
- **値**: 10Ω, 10kΩなど

### スクリュー端子の設定

![スクリュー端子プロパティ](02_figure/25_symbol_properties_screw_terminal.png)

- **リファレンス**: J1, J2, J3
- **値**: Screw_Terminal_01x02

### 値設定完了後の回路図

![値設定完了](02_figure/33_schematic_with_values.png)

---

## 7. フットプリントの割り当て

### フットプリント割り当ての重要性

シンボル（回路図上の部品）とフットプリント（PCB上の実装パターン）を対応付ける必要があります。

### インダクタのフットプリント

![トロイダルコイルフットプリント](02_figure/17_footprint_chooser_toroid.png)

**フットプリント選択**:
- 検索: `toroid`
- 選択例: `L_Toroid_Vertical_L26.7mm_W14.0mm_P10.16mm_Pulse_D`

### ダイオードのフットプリント

![ダイオードフットプリント](02_figure/18_footprint_chooser_diode.png)

**フットプリント選択**:
- 検索: `to-220` または `DO-201`
- 選択例: `D_P600_R-6_P20.00mm_Horizontal`（大電流ダイオード用）

### コンデンサのフットプリント

![コンデンサフットプリント](02_figure/21_footprint_chooser_capacitor.png)

**フットプリント選択**:
- 検索: `C_*`
- 選択例: `C_Radial_D16.0mm_H25.0mm_P7.50mm`（電解コンデンサ）

### 抵抗のフットプリント

![抵抗フットプリント](02_figure/23_footprint_chooser_resistor.png)

**フットプリント選択**:
- 検索: `R_Axial`
- 選択例: `R_Axial_DIN0207_L6.3mm_D2.5mm_P10.16mm_Horizontal`

### MOSFETのフットプリント

![MOSFET TO-220フットプリント](02_figure/29_footprint_chooser_mosfet_to220.png)

**フットプリント選択**:
- 検索: `to-220`
- 選択例: `TO-220-3_Vertical`

**重要**: TO-220のピン配置は必ずデータシートで確認してください！

#### ピン番号の確認

MOSFETのピン配置を確認・修正する場合:

![ゲートピンプロパティ](02_figure/30_pin_properties_gate.png)
- ピン名: G（ゲート）
- ピン番号: 2

![ドレインピンプロパティ](02_figure/34_pin_properties_drain.png)
- ピン名: D（ドレイン）
- ピン番号: 2（パッケージ例）

![ソースピンプロパティ](02_figure/35_pin_properties_source.png)
- ピン名: S（ソース）
- ピン番号: 3（パッケージ例）

### ターミナルブロックのフットプリント

![ターミナルブロックフットプリント](02_figure/26_footprint_chooser_terminal_block.png)

**フットプリント選択**:
- 検索: `TerminalBlock`
- 選択例: `TerminalBlock_CUI_TB007-508-02_1x02_P5.08mm_Horizontal`

---

## 8. PCBレイアウト

### PCBエディタを開く

1. 回路図エディタのメニューから **ツール (T)** → **PCBエディタを更新**
2. または、プロジェクトマネージャから**PCBエディタ**アイコンをクリック

### 初回起動時

![空のPCBエディタ](02_figure/27_pcb_editor_blank.png)

空のPCBエディタが開きます。

### 回路図からPCBへの更新

**ツール (T)** → **回路図から基板を更新** を選択

または、ツールバーの以下のアイコンをクリックします:

![回路図からフットプリント更新アイコン](02_figure/42_icon_update_pcb_from_schematic.png)

#### エラーが発生する場合

![PCB更新エラー](02_figure/28_update_pcb_from_schematic_error.png)

**エラー内容**: Q1を追加できません（関連付けられたフットプリントがありません）

**対処法**:
1. 回路図エディタに戻る（ツールバーの以下のアイコンをクリック）

![回路図に戻るアイコン](02_figure/43_icon_back_to_schematic.png)

2. すべての部品にフットプリントを割り当てる
3. 再度「回路図から基板を更新」を実行

#### 更新成功

![PCB更新成功](02_figure/31_update_pcb_from_schematic_success.png)

**適用された変更**:
- シンボル R1、R2のフットプリントを処理
- ピン1をNet=(Q1-G)に接続

合計警告数: 0、エラー数: 0

### 部品配置

![PCBに部品配置](02_figure/32_pcb_with_components.png)

**部品配置のポイント**:
- **M**キーで部品を移動
- **R**キーで部品を回転
- 白い線（ラッツネスト）は配線が必要な接続を示す
- スクリュー端子は基板の端に配置
- 大電流が流れる部品（L1、Q1、D1、C1）は近くに配置
- 放熱を考慮してMOSFETとダイオードの配置を検討

![レイアウト作業中](02_figure/36_pcb_layout_in_progress.png)

基板の外形（ピンクの枠）内に部品を配置します。

---

## 9. 配線（ルーティング）

### 配線の基本操作

- **X**キーを押すか、ツールバーの配線アイコンをクリックすると配線モードになります

![配線アイコン](02_figure/44_icon_routing.png)
- パッドをクリックして、接続先までドラッグします
- トラック幅は左側のツールバーで設定できます
- 配線するレイヤーは右側のツールバーで選択できます

![レイヤー選択アイコン](02_figure/45_icon_layer_selection.png)

### ビアを使った裏面配線

表面（F.Cu）だけでは配線が交差して引けない場合、**ビア**を使って裏面（B.Cu）に配線を通すことができます。

#### ステップ1: ビアの配置

配線モード（**X**キー）で配線中に、**V**キーを押すとビアが配置されます。

![ビア配置開始](02_figure/48_via_placement_start.png)

**図**: 配線中に**V**キーを押すと、ビア（白い円）が配置される

- 赤い配線は表面（F.Cu）レイヤー
- ビアは両面を貫通する穴

#### ステップ2: 裏面への切り替え

ビアをクリックすると、自動的に裏面（B.Cu）レイヤーに切り替わり、そこから配線を続けられます。

![裏面に切り替え](02_figure/49_via_layer_change.png)

**図**: ビアをクリック後、裏面（B.Cu）で配線を継続

- 青い配線は裏面（B.Cu）レイヤー
- ツールバーのレイヤー表示が「B.Cu (PgDn)」に変わる

#### ステップ3: 表面に戻る

裏面で配線を続け、再度**V**キーを押してビアを配置すると、表面に戻れます。

![表面に戻る](02_figure/50_via_back_to_front.png)

**図**: 2つ目のビアを配置して表面（F.Cu）に戻る

- 2つのビア間を裏面（青）で接続
- 表面の配線（赤）と交差せずに配線できる

**ビア配置のショートカット**:

| キー | 動作 |
|------|------|
| **V** | 配線中にビアを配置してレイヤーを切り替え |
| **PgUp** | 表面（F.Cu）レイヤーに切り替え |
| **PgDn** | 裏面（B.Cu）レイヤーに切り替え |

---

### 配線完了

![配線完了](02_figure/37_pcb_routing_complete.png)

**配線のポイント**:
- 大電流経路（インダクタ→MOSFET/ダイオード→コンデンサ）は太い配線を使用
- ゲート配線は細い配線でOK
- 配線は45°または直角で行う
- できるだけ短く、シンプルに配線
- 配線が交差する場合はビアを使って裏面に逃がす

---

## 10. グラウンドプレーンの作成

### ベタGND（グラウンドプレーン）の追加

ベタGNDを追加することで:
- GND接続が簡単になる
- ノイズ耐性が向上
- 放熱効果が得られる

### ゾーンツールの使用

1. 右側ツールバーから**塗りつぶしゾーン追加**アイコンをクリック

![ベタグランドアイコン](02_figure/46_icon_fill_zone.png)

2. 基板の外形に沿って領域を指定

### ゾーンプロパティの設定

![ゾーンプロパティ](02_figure/38_zone_properties_gnd.png)

**設定項目**:
- **ゾーン名**: （空欄でOK）
- **ネット**: GND を選択
- **塗りつぶしタイプ**: ベタ塗り
- **クリアランス**: 0.5mm
- **最小幅**: 0.25mm
- **パッド接続**: サーマルリリーフ
- **サーマルリリーフのギャップ**: 0.5mm

### グラウンドプレーン完成

![グラウンドプレーン付きPCB](02_figure/39_pcb_with_ground_plane.png)

青いベタGNDが基板全体に配置されました。

**グラウンドプレーンの効果**:
- GNDピンが自動的にベタGNDに接続される
- サーマルリリーフ（十字の接続）により、はんだ付けが容易
- 電磁ノイズの低減
- 熱の拡散

---

## 11. デザインルールチェック

### DRCの実行

設計が完了したら、デザインルールチェック（DRC）を実行して、設計ミスがないか確認します。

### DRCダイアログを開く

**検査 (I)** → **デザインルールチェッカー** を選択

または、ツールバーの以下のアイコンをクリックします:

![DRCアイコン](02_figure/47_icon_drc_check.png)

![DRC実行前](02_figure/40_design_rule_check_initial.png)

### DRC実行

**DRCを実行**ボタンをクリックします。

### DRC成功

![DRC成功](02_figure/41_design_rule_check_success.png)

**結果**:
- 違反: 0
- 未配線アイテム: 0
- 回路図の等価性（実行しない）
- テストしない項目: 5

**エラー数: 0、警告数: 0** → 設計完了！

---

## まとめ

このガイドでは、KiCadを使った昇圧回路の設計から製造データ作成までの一連の流れを解説しました。

### 設計フロー

1. プロジェクト作成
2. ライブラリ設定
3. 回路図作成（シンボル配置→配線→値設定）
4. フットプリント割り当て
5. PCBレイアウト（部品配置）
6. 配線（ルーティング）
7. グラウンドプレーン作成
8. デザインルールチェック
9. （次のステップ）ガーバーファイル出力 → 製造発注

### 重要なポイント

- **フットプリントの選択**: 実際の部品のパッケージと一致させる
- **ピン配置の確認**: 特にMOSFETやICは必ずデータシートで確認
- **大電流経路**: 太い配線を使用し、短く配線する
- **グラウンドプレーン**: 必ず作成してノイズ対策を行う
- **DRC**: 必ず実行してエラーを確認する

### 次のステップ

- ガーバーファイルの出力
- 3Dビューアで外観確認
- 製造業者（JLCPCB、Elecrowなど）への発注
- 部品表（BOM）の作成

---

## トラブルシューティング

### よくあるエラーと対処法

#### 「フットプリントがありません」エラー
- すべての部品にフットプリントを割り当てたか確認
- シンボルプロパティでフットプリント欄が空欄になっていないか確認

#### 配線できない
- グリッドサイズを調整（表示メニュー）
- トラック幅が大きすぎる場合は細くする
- ビアを使って層を変更する

#### DRCでエラーが出る
- クリアランス不足 → 配線を修正
- 未配線 → すべての接続を確認
- ショート → 配線が重なっていないか確認

---

**作成日**: 2025-11-20
**KiCadバージョン**: 9.0
**対象回路**: 昇圧回路 (Boost Converter)
